{"title":"Introduction into data vis","markdown":{"headingText":"Introduction into data vis","containsRefs":false,"markdown":"\n## The data used in this course\n\nDataset Source: [International migration flows to and from selected countries - The 2015 revision](http://www.un.org/en/development/desa/population/migration/data/empirical2/migrationflows.shtml?utm_medium=Exinfluencer&utm_source=Exinfluencer&utm_content=000026UJ&utm_term=10006555&utm_id=NA-SkillsNetwork-Channel-SkillsNetworkCoursesIBMDeveloperSkillsNetworkDV0101ENSkillsNetwork20297740-2021-01-01).\n\nThe dataset contains annual data on the flows of international immigrants as recorded by the countries of destination. The data presents both inflows and outflows according to the place of birth, citizenship or place of previous / next residence both for foreigners and nationals. The current version presents data pertaining to 45 countries.\n\nIn this lab, we will focus on the Canadian immigration data.\n\nThe Canada Immigration dataset can be fetched from <a href=\"https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-DV0101EN-SkillsNetwork/Data%20Files/Canada.xlsx?utm_medium=Exinfluencer&utm_source=Exinfluencer&utm_content=000026UJ&utm_term=10006555&utm_id=NA-SkillsNetwork-Channel-SkillsNetworkCoursesIBMDeveloperSkillsNetworkDV0101ENSkillsNetwork20297740-2021-01-01\">here</a>.\n\n### Read and clean the data\n\n```{python}\n#load libs\nimport pandas as pd\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\n```\n\n```{python}\n#load data\ndf_can = pd.read_excel(\"../data/Canada.xlsx\", sheet_name='Canada by Citizenship',skiprows=range(20), skipfooter=2)\n\n#check data\ndf_can.head()\n```\n\nLet's first inspect the data frame, to get a feel for what we have:\n\n```{python}\n#get a summary\ndf_can.info(verbose = False)\n```\n\n```{python}\n#get column headers\ndf_can.columns\n```\n\n```{python}\n#view the dimensions of our data\ndf_can.shape\n```\n\nNow, lets clean the data and remove some unnecessary columns using `drop()`\n\n```{python}\ndf_can.drop(['AREA','REG','DEV','Type','Coverage'], axis = 1, inplace = True)\ndf_can.head()\n```\nLet's rename the columns so that they make sense. We can use rename() method by passing in a dictionary of old and new names as follows:\n\n```{python}\ndf_can.rename(columns = {'OdName':'Country', 'AreaName':'Continent', 'RegName':'Region'}, inplace = True)\n\ndf_can.columns\n```\n\nWe will also add a 'Total' column that sums up the total immigrants by country over the entire period 1980 - 2013, as follows\n\n```{python}\ndf_can['Total'] = df_can.sum(axis = 1)\ndf_can.head()\n```\n\n\nCheck for null objects:\n\n```{python}\ndf_can.isnull().sum()\n```\n\nLet's view a quick summary of each column in our dataframe using the describe() method.\n\n```{python}\ndf_can.describe()\n```\nBefore we proceed, notice that the default index of the dataset is a numeric range from 0 to 194. This makes it very difficult to do a query by a specific country. For example to search for data on Japan, we need to know the corresponding index value.\n\nThis can be fixed very easily by setting the 'Country' column as the index using set_index() method.\n\nTip: The opposite of set is reset. So to reset the index, we can use df_can.reset_index()\n\n```{python}\ndf_can.set_index('Country', inplace = True)\ndf_can.head()\n```\n\nColumn names that are integers (such as the years) might introduce some confusion. For example, when we are referencing the year 2013, one might confuse that when the 2013th positional index.\n\nTo avoid this ambuigity, let's convert the column names into strings: '1980' to '2013'.\n\n```{python}\ndf_can.columns = list(map(str, df_can.columns))\n# [print (type(x)) for x in df_can.columns.values] #<-- uncomment to check type of column headers\ndf_can.head()\n```\nSince we converted the years to string, let's declare a variable that will allow us to easily call upon the full range of years:\n\n```{python}\nyears = list(map(str, range(1980, 2014)))\nyears\n```\n\n\nLets review the changes\n\n```{python}\nprint('data dimensions:', df_can.shape)\nprint(df_can.columns)\n```\n\n\n## Background into Matplotlib\n\nThe primary plotting library we will explore in the course is [Matplotlib](http://matplotlib.org/?utm_medium=Exinfluencer&utm_source=Exinfluencer&utm_content=000026UJ&utm_term=10006555&utm_id=NA-SkillsNetwork-Channel-SkillsNetworkCoursesIBMDeveloperSkillsNetworkDV0101ENSkillsNetwork20297740-2021-01-01).  As mentioned on their website:\n\n> Matplotlib is a Python 2D plotting library which produces publication quality figures in a variety of hardcopy formats and interactive environments across platforms. Matplotlib can be used in Python scripts, the Python and IPython shell, the jupyter notebook, web application servers, and four graphical user interface toolkits.\n\nIf you are aspiring to create impactful visualization with python, Matplotlib is an essential tool to have at your disposal.\n\n\n### Layers\n\nMatplotlib's architecture is composed of three main layers: \n\n#### Backend layer\n\nThe **Back-end layer**, which comes with three build-in abstract interacted\n\n- Figure canvas: encompasses the area on which the figure is drawn\n- Renderer: knows how to draw the figure canvas\n- Event: which handels user inputs, such as keyboard strokes or mouse clicks\n\n\n#### Artist layer\n\nThe **Artist layer** where much of the heavy lifting happens and is usually the appropriate programming paradigm when writing a web application server, or a UI application, or perhaps a script to be shared with other developers. Its composed of one main object, the **Artist**. The artist knows how to use the renderer to draw on the canvas. There are two types of artist objects:\n\n- Primitive: Line2D, rectangle, circle, text\n- Composite: Axes, Tick and figure\n\n\n#### Scripting layer\n\nThe **Scripting layer**, which is the appropriate layer for everyday purposes and is considered a lighter scripting interface to simplify common tasks and for a quick and easy generation of graphics and plots. \n\nThis layer is mainly comprised of pyplot, a scripting interface that is lighter than the Artist layer. \n\n\n\n## Matplotlib.Pyplot\n\nOne of the core aspects of Matplotlib is matplotlib.pyplot, Matplotlib's scripting layer. It is a collection of command style functions that make Matplotlib work like MATLAB. Each pyplot function makes some change to a figure: e.g., creates a figure, creates a plotting area in a figure, plots some lines in a plotting area, decorates the plot with labels, etc. \n\n\nFor aesthetics we can check and apply styles in matplotlib as follows:\n\n```{python}\nprint(plt.style.available)\nmpl.style.use(['ggplot']) # optional: for ggplot-like style\n```\n\n## Plotting in pandas\n\nPandas has a built-in implementation of Matplotlib that we can use. Plotting in *pandas* is as simple as appending a `.plot()` method to a series or dataframe.\n\nDocumentation:\n\n*   [Plotting with Series](http://pandas.pydata.org/pandas-docs/stable/api.html?utm_medium=Exinfluencer&utm_source=Exinfluencer&utm_content=000026UJ&utm_term=10006555&utm_id=NA-SkillsNetwork-Channel-SkillsNetworkCoursesIBMDeveloperSkillsNetworkDV0101ENSkillsNetwork20297740-2021-01-01#plotting)<br>\n*   [Plotting with Dataframes](http://pandas.pydata.org/pandas-docs/stable/api.html?utm_medium=Exinfluencer&utm_source=Exinfluencer&utm_content=000026UJ&utm_term=10006555&utm_id=NA-SkillsNetwork-Channel-SkillsNetworkCoursesIBMDeveloperSkillsNetworkDV0101ENSkillsNetwork20297740-2021-01-01#api-dataframe-plotting)\n\n\n## Line plots\n\nA line plot is a plot in the form of a series of data points connected by straight line segments.\n\nhe best use case for a line plot is when you have a continuous dataset and you're interested in visualizing the data over a period of time.\n\nLine plot is a handy tool to display several dependent variables against one independent variable. However, it is recommended that no more than 5-10 lines on a single graph; any more than that and it becomes difficult to interpret.\n\n**A case study**\n\nIn 2010, Haiti suffered a catastrophic magnitude 7.0 earthquake. The quake caused widespread devastation and loss of life and aout three million people were affected by this natural disaster. As part of Canada's humanitarian effort, the Government of Canada stepped up its effort in accepting refugees from Haiti. We can quickly visualize this effort using a Line plot:\n\nFirst, lets extract the data\n\n```{python}\nhaiti = df_can.loc['Haiti', years]\nhaiti.head()\n```\n\nNext, we can plot:\n\n```{python}\nhaiti.plot()\nplt.show()\nplt.close()\n```\n\npandas automatically populated the x-axis with the index values (years), and the y-axis with the column values (population). However, notice how the years were not displayed because they are of type string. Therefore, let's change the type of the index values to integer for plotting.\n\nAlso, let's label the x and y axis using plt.title(), plt.ylabel(), and plt.xlabel() as follows:\n\n```{python}\n## let's change the index values of Haiti to type integer for plotting\nhaiti.index = haiti.index.map(int)\n\n#plot\nhaiti.plot(kind = 'line')\n\n#add labels\nplt.title(\"Immigration from Haiti\")\nplt.ylabel(\"Number of immigrants\")\nplt.xlabel(\"Years\")\n\nplt.show()\nplt.close()\n```\n\nWe can clearly notice how number of immigrants from Haiti spiked up from 2010 as Canada stepped up its efforts to accept refugees from Haiti. Let's annotate this spike in the plot by using the `plt.text()` method.\n\n\n```{python}\n#plot\nhaiti.plot(kind = 'line')\n\n#add labels\nplt.title(\"Immigration from Haiti\")\nplt.ylabel(\"Number of immigrants\")\nplt.xlabel(\"Years\")\n\n# annotate the 2010 Earthquake. \n# syntax: plt.text(x, y, label)\nplt.text(2000, 6000, \"2010 Earthquake\")\n\nplt.show()\nplt.close()\n```\n\n\nLet's compare the number of immigrants from India and China from 1980 to 2013.\n\nStep 1: Get the data set for China and India, and display the dataframe.\n\n```{python}\ndf_CI = df_can.loc[[\"China\", \"India\"], years]\ndf_CI.head()\n```\n\nLet's try plotting\n\n```{python}\n#plot\ndf_CI.plot(kind = 'line')\n\nplt.show()\nplt.close()\n```\n\nThat doesn't look right.\n\nPandas plots the indices on the x-axis and the columns as individual lines on the y-axis. Since df_CI is a dataframe with the country as the index and years as the columns, we must first transpose the dataframe using `transpose()` method to swap the row and columns.\n\n```{python}\ndf_CI = df_CI.transpose()\ndf_CI.head()\n```\n\n```{python}\n#change the index values\ndf_CI.index = df_CI.index.map(int)\n\n#plot\ndf_CI.plot(kind = 'line')\n\n#add labels\nplt.title(\"Immigration from China and India\")\nplt.ylabel(\"Number of immigrants\")\nplt.xlabel(\"Years\")\n\nplt.show()\nplt.close()\n```\n\n\nQuestion: Compare the trend of top 5 countries that contributed the most to immigration to Canada.\n\nTo make the plot more readeable, we will change the size using the `figsize` parameter.\n\n```{python}\n#sort our data by the total column\ndf_can.sort_values(by = \"Total\", ascending = False, axis = 0, inplace = True)\n\n#get top five hits\ndf_top5 = df_can.head(5)\n\n#transpose the data\ndf_top5 = df_top5[years].transpose()\n\n#change the index values\ndf_top5.index = df_top5.index.map(int)\n\n#plot\ndf_top5.plot(kind='line', figsize=(8, 8))\n\n#add labels\nplt.title(\"Immigration in the top 5 countries that contributed most to immigration\")\nplt.xlabel(\"Years\")\nplt.ylabel(\"Number of immigrants\")\n\n\nplt.show()\nplt.close()\n```\n\n## Other Plots\n\nCongratulations! you have learned how to wrangle data with python and create a line plot with Matplotlib. There are many other plotting styles available other than the default Line plot, all of which can be accessed by passing kind keyword to plot(). The full list of available plots are as follows:\n\nbar for vertical bar plots\nbarh for horizontal bar plots\nhist for histogram\nbox for boxplot\nkde or density for density plots\narea for area plots\npie for pie plots\nscatter for scatter plots\nhexbin for hexbin plot\n"},"formats":{"html":{"execute":{"fig-width":3.5,"fig-height":3.5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"1_intro.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","space-before-code-block":"10pt","space-after-code-block":"8pt","linespacing":"22pt plus2pt","frontmatter-linespacing":"17pt plus1pt minus1pt","title-size":"22pt","title-size-linespacing":"28pt","gap-before-crest":"25mm","gap-after-crest":"25mm","execute-dir":"file","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":3.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"pdflatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"github","output-file":"1_intro.pdf"},"language":{},"metadata":{"block-headings":true,"space-before-code-block":"10pt","space-after-code-block":"8pt","linespacing":"22pt plus2pt","frontmatter-linespacing":"17pt plus1pt minus1pt","title-size":"22pt","title-size-linespacing":"28pt","gap-before-crest":"25mm","gap-after-crest":"25mm","execute-dir":"file","documentclass":"scrreprt","geometry":["heightrounded"],"pandoc_args":"--listings","header-includes":["\\usepackage{fvextra} \\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\\\\{\\}}"],"colorlinks":true,"code-block-bg":"D3D3D3"},"extensions":{"book":{}}}}}