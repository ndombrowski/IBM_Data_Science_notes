{"title":"Basic SQL","markdown":{"headingText":"Basic SQL","containsRefs":false,"markdown":"\n## Introduction\n\nWhat is SQL?\n\n- Structured English Query language\n- Language used for relational databases\n- Used to query data\n\nWhat is data?\n\n- A collection of facts with words, numbers or pictures\n- One of the most critical assets in any business\n- Needs to be secure\n\nWhat is a database?\n\n- A repository of data\n- Provides functionality to add, modify and query data\n- Different kind of databases for different requirements\n\nRelational database:\n\n- Data is stored in tabular form, i.e. consists of rows and columns\n- Columns contain properties, i.e names, age\n- A table is a collection of related things, i.e. list of employees\n- We can make relationships between tables (hence: relational)\n\nDBMS:\n\n- Database Management system, a software to manage databases\n- Interchangeable use of database, database server, database sytem, data server or DBMS\n\n\nRDBMS:\n\n- Relational database management system\n- Set of software tools that controls the data\n  - controls access, organization and storage\n- Examples; MySQL, Oracle, IBM Dbs, etc\n\n\n\n## The SELECT statement\n\n### How to retrieve rows from a table\n\n- After creating a table and inserting data into a table we want to see the data\n- SELECT statement is a data manipulation language (DML) statement used to read and modify data\n- The select statement is called a query\n- The output we get from a query is called the results\n- The basic command looks like this\n\n```\nSELECT * from <tablename>\n```\n\n- We can only retrieve the columns we want, i.e.\n\n```\nSELECT <column1>, <column2> from <tablename>\n```\n\n- The order in the columns displayed table matches the order in the used select statement\n\n### Restricting the results set via the WHERE clause\n\n- This clause restricts the results set\n- Requires a predicate that is conditions to\n  - evaluate to true, false or unknown\n  - predicates are used in the search condition of the where clause\n- Example: We want to have the title from the book with the book ID B1\n\n```\nSELECT column1, column2, ...\nFROM table_name\nWHERE condition\n;\n```\n\n- FROM: Specifies from which table to get the data. The clause can include optional JOIN subclauses to specify the rules for joining tables.\n- [Optional Clause] WHERE : Specifies which rows to retrieve.\n- Some database systems require a semicolon at the end of each SQL statement for execution. It is a standard way to separate one SQL statement from another which allows more than one SQL statement to be executed in the same call to the server. So, it is good practice to use a semicolon at the end of each SQL statement.\n\n```\nSELECT book_id, title from Book.db\n  WHERE book_id = 'B1'\n```\n\n- We can also use other comparison operators\n  - equal to --> =\n  - greater than --> >\n  - less than --> <\n  - greater than or equal to --> >=\n  - less than or equal to --> <=\n  - not equal to --> <>\n  \n\n### Exercise\n  \nTo reproduce the example, we\n\n- Downloaded datasette from the web\n- Downloaded the SanFranciscoFilmLocations database as csv from [here](https://data.sfgov.org/Culture-and-Recreation/Film-Locations-in-San-Francisco/yitu-d5am/data)\n- we converted this to a datasette database with `csvs-to-sqlite Film_Locations_in_San_Francisco.csv Film_Locations_in_San_Francisco.db`\n- and opened the datasette with `datasette Film_Locations_in_San_Francisco.db`\n\nWe can also load the db into r:\n\n#### Task A: explore the database\n\n```{r setup}\nlibrary(DBI)\ndb = dbConnect(RSQLite::SQLite(), dbname =\"Week1/Film_Locations_in_San_Francisco.db\")\n\n#set connection for each chunk, other wise we would need `{sql, connection=db}`\nknitr::opts_chunk$set(connection = \"db\", max.print = 10)\n#knitr::opts_chunk$set(connection = \"db2\", max.print = 5)\n\n#show less columns\n#options(max.print = 5)\n```\n\n#### Task B: Example exercises\n\n1. In this example, suppose we want to retrieve details of all the films from the \"FilmLocations\" table. The details of each film record should contain all the film columns.\n\n```{sql}\nSELECT * FROM Film_Locations_in_San_Francisco\n```\n\n\n2. In this example, now we want to retrieve selective details of all the film records. Let us retrieve the names of all the films along with director names and writer names.\n\n```{sql}\nSELECT Title, Director,Writer FROM Film_Locations_in_San_Francisco\n```\n\n\n3. In this example, we want to retrieve film names along with filming locations and release years. But we also want to restrict the output resultset so that we can retrieve only the film records released in 2001 and onwards (release years after 2001 including 2001).\n\n**Notice** If we have a space in the column header, we need to use quotes.\n\n```{sql}\nSELECT Title, Locations,\"Release Year\" FROM Film_Locations_in_San_Francisco\nWHERE \"Release Year\" >=2001\n```\n4. Retrieve the fun facts and filming locations of all films.\n\n```{sql}\nSELECT \"Fun Facts\",Locations FROM Film_Locations_in_San_Francisco\n```\n5. Retrieve the names of all films released in the 20th century and before (release years before 2000 including 2000) that, along with filming locations and release years.\n\n```{sql}\nSELECT Title,Locations,\"Release Year\" FROM Film_Locations_in_San_Francisco\nWHERE \"Release Year\" <= 2000\n```\n6. Retrieve the names, production company names, filming locations, and release years of the films which are not written by James Cameron.\n\n```{sql}\nSELECT Title,\"Production Company\",Locations, \"Release Year\", Writer FROM Film_Locations_in_San_Francisco\nWHERE Writer <> \"James Cameron\"\n```\n\n## Count, Distinct, limit\n\n### Count\n\n- Number of rows that meet target criteria\n- `select COUNT(*) from table` to get the total number of rows in a table\n- `select COUNT(COUNTRY) from Medals; where COUNTRY='Canada'`: Rows in the medals table were the country is Canada\n\n\n### Distinct\n\n- Remove duplicate values\n- `select DISTINCT columnname from table `: retrieve unique values in a column\n- `select DISTINCT Country from Medals; where Medaltype == 'GOLD'`: get a list of unique countries that received gold medals\n\n\n### Limit\n\n- Used to restrict the number of rows retrieved from a database\n- `select * from table LIMIT 10`: retrieve only the first 10 rows\n- `select * from Medals; where YEAR = 2018 LIMIT 5`: retrieve 5 rows in the Medals table for a specific year\n\n\n\n#### Exercises\n\n1. Retrieve the number of rows from the \"FilmLocations\" table.\n\n```{sql}\nselect COUNT(*) from Film_Locations_in_San_Francisco\n```\n2. In this example, now we want to count the number of locations of the films. But we also want to restrict the output resultset in such a way that we only retrieve the number of locations of the films written by a certain writer. Retrieve the number of locations of the films which are written by James Cameron.\n\n```{sql}\nselect COUNT(Locations) from Film_Locations_in_San_Francisco\nwhere Writer = \"James Cameron\"\n```\n3. Retrieve the number of locations of the films which are directed by Woody Allen.\n\n```{sql}\nselect COUNT(Locations) from Film_Locations_in_San_Francisco\nwhere Director = \"Woody Allen\"\n```\n\n4. Retrieve the number of films shot at Russian Hill.\n\n```{sql}\nselect COUNT(Title) from Film_Locations_in_San_Francisco\nwhere Locations = \"Russian Hill\"\n```\n5. Retrieve the number of rows having a release year older than 1950 from the \"FilmLocations\" table.\n\n```{sql}\nselect COUNT(*) from Film_Locations_in_San_Francisco\nwhere \"Release Year\" > 1950\n```\n\n6. In this example, we want to retrieve the title of all films in the table in such a way that duplicates will be discarded in the output resultset. Retrieve the name of all films without any repeated titles.\n\n\n```{sql}\nselect DISTINCT Title from Film_Locations_in_San_Francisco\n```\n\n7. In this example, we want to retrieve the count of release years of the films produced by a specific company in such a way that duplicate release years of those films will be discarded in the count. Retrieve the number of release years of the films distinctly, produced by Warner Bros. Pictures.\n\n```{sql}\nselect COUNT(DISTINCT \"Release Year\") from Film_Locations_in_San_Francisco\nwhere \"Production Company\" = \"Warner Bros. Pictures\"\n```\n8. Retrieve the name of all unique films released in the 21st century and onwards, along with their release years.\n\n```{sql}\nselect DISTINCT Title, \"Release Year\" from Film_Locations_in_San_Francisco\nwhere \"Release Year\" >= 2001\n```\n\n9. Retrieve the names of all the directors and their distinct films shot at City Hall.\n\n```{sql}\nselect DISTINCT Director, Title from Film_Locations_in_San_Francisco\nwhere Locations = \"City Hall\"\n```\n\n\n10. Retrieve the number of distributors distinctly who distributed films acted by Clint Eastwood as 1st actor.\n\n```{sql}\nselect COUNT (DISTINCT Distributor) from Film_Locations_in_San_Francisco\nwhere \"Actor 1\" = \"Clint Eastwood\"\n```\n\n11. In this example, let us retrieve a specific number of rows from the top of the table in such a way that rows other than those are not in the output resultset. Retrieve the first 25 rows from the \"FilmLocations\" table.\n\n```{sql}\nselect * from Film_Locations_in_San_Francisco Limit 25\n```\n\n12. In this example, let us take the first example to a more advanced level. Now we want to retrieve a specific number of rows from the table, but this time, not from the top of the table. This time we want to retrieve a specific number of rows starting from a specific row in the table. Retrieve the first 15 rows from the \"FilmLocations\" table starting from row 11. For this we use **OFFSET**\n\n\n```{sql}\nselect * from Film_Locations_in_San_Francisco Limit 15 OFFSET 10\n```\n\n13. Retrieve the name of first 50 films distinctly.\n\n```{sql}\nselect Distinct Title from Film_Locations_in_San_Francisco Limit 50\n```\n\n14. Retrieve first 10 film names distinctly released in 2015.\n\n```{sql}\nselect Distinct Title from Film_Locations_in_San_Francisco\nwhere \"Release Year\" = 2015 Limit 10\n```\n\n\n15. Retrieve the next 3 film names distinctly after first 5 films released in 2015.\n\n```{sql}\nselect Distinct Title from Film_Locations_in_San_Francisco\nwhere \"Release Year\" = 2015 Limit 3 OFFSET 5\n```\n\n\n## Insert\n\n- The insert statement is used to add rows to a table\n- Its a DML statement used to read and modify data\n\nI.e lets add something to the author table, ie a new author:\n\n```\nInsert into Author.db\n  (Author_ID, Lastname, Firstname)\nValues(\"A1\", \"Chong\", \"Raul\")\n```\n\n- Important: the number of provided values should equal the number of column names specified in the column name list \n\nWe can insert multiple rows like this:\n\n```\nInsert into Author.db\n  (Author_ID, Lastname, Firstname)\nValues\n  (\"A1\", \"Chong\", \"Raul\")\n  (\"A2\", \"Ahuja\", \"Rai\")\n```\n\n\n## Update\n\n- Update is used alter existing data in a table\n- If we don't specify the where statement, ALL rows in the table will be updated\n\nWe want to update the Last and first Name for the author with the ID A2:\n\n```\nUpdate Author.db\nSET LastName=\"Katta\"\n  Firstname=\"Lakshimi\"\n  Where author_id='A2'\n```\n\n\n\n## Delete\n\n- used to remove 1 or more rows\n\nWe want to delete the rows for author ID A2 and A3\n\n```\nDelete from author.db\n  Where author_id IN ('A2', \"A3\")\n```\n\n\n### Exercise\n\nPrepare the data by copy/pasting the data from the online tutorial into excel and save as csv. It was converted to an sql database with `csvs-to-sqlite Instructor.csv Instructor.db`\n\nPrep database for R\n\n```{r}\ndb2 = dbConnect(RSQLite::SQLite(), dbname =\"Week1/Instructor.db\")\n```\n\n\n1. First have a look at the database\n\n```{sql, connection=db2}\nSelect * from Instructor\n```\n\n2. In this example, suppose we want to insert a new single row into the Instructor table. Insert a new instructor record with id 4 for Sandip Saha who lives in Edmonton, CA into the \"Instructor\" table.\n\n```{sql, connection=db2}\nInsert into Instructor (ins_id, lastname, firstname, city, country)\nVALUES (\"4\", \"Sandip\", \"Saha\", \"Edmonton\", \"CA\")\n```\n\n```{sql, connection=db2}\nSelect * from Instructor\n```\n\n3. n this example, suppose we want to insert some new multiple rows into the Instructor table. Insert two new instructor records into the \"Instructor\" table. First record with id 5 for John Doe who lives in Sydney, AU. Second record with id 6 for Jane Doe who lives in Dhaka, BD.\n\n```{sql, connection=db2}\nINSERT INTO Instructor(ins_id, lastname, firstname, city, country)\nVALUES(5, 'Doe', 'John', 'Sydney', 'AU'), (6, 'Doe', 'Jane', 'Dhaka', 'BD') \n```\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 10\n```\n\n4. Insert a new instructor record with id 7 for Antonio Cangiano who lives in Vancouver, CA into the \"Instructor\" table.\n\n```{sql, connection=db2}\nInsert into Instructor(ins_id, lastname, firstname, city, country)\nValues(7, \"Cangiano\", \"Antonio\", \"Vancouver\", \"CA\")\n```\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5 OFFSET 4\n```\n\n5. nsert two new instructor records into the \"Instructor\" table. First record with id 8 for Steve Ryan who lives in Barlby, GB. Second record with id 9 for Ramesh Sannareddy who lives in Hyderabad, IN.\n\n```{sql, connection=db2}\nInsert into Instructor(ins_id, lastname, firstname, city, country)\nValues(8, \"Ryan\", \"Steve\", \"Varly\", \"GB\"),(9, \"Sannareddy\", \"Ramesh\", \"Hyderabad\", \"IN\")\n```\n\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5 OFFSET 4\n```\n\n6. In this example, we want to update one column of an existing row of the table. Update the city for Sandip to Toronto.\n\n```{sql, connection=db2}\nUpdate Instructor\nSet city=\"Toronto\"\nWhere lastname=\"Sandip\"\n```\n\n\n```{sql, connection=db2}\nSelect * from Instructor\n```\n\n7. Update the city and country for Doe with id 5 to Dubai and AE respectively.\n\n```{sql, connection=db2}\nUpdate Instructor\nSet city=\"Dubai\", country=\"AE\"\nWhere lastname=\"Doe\"\n```\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5 Offset 2\n```\n\n\n8. Update the city of the instructor record to Markham whose id is 1.\n\n```{sql, connection=db2}\nUpdate Instructor\nSet city=\"Markham\"\nWhere ins_id=1\n```\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5 Offset 0\n```\n\n9. Update the city and country for Sandip with id 4 to Dhaka and BD respectively.\n\n```{sql, connection=db2}\nUpdate Instructor\nSet city=\"Dhaka\", country=\"DB\"\nWhere ins_id=4\n```\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5 Offset 1\n```\n\n10. In this example, we want to remove a row from the table. Remove the instructor record of Doe whose id is 6.\n\n```{sql, connection=db2}\nDelete from Instructor\nwhere ins_id=6\n```\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5 Offset 3\n```\n\n11. Remove the instructor record of Hima.\n\n```{sql, connection=db2}\nDelete from Instructor\nWhere firstname=\"Hima\"\n```\n\n\n```{sql, connection=db2}\nSelect * from Instructor Limit 5\n```\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"Week1-Notes.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.168","bibliography":["references.bib"],"space-before-code-block":"10pt","space-after-code-block":"8pt","linespacing":"22pt plus2pt","frontmatter-linespacing":"17pt plus1pt minus1pt","title-size":"22pt","title-size-linespacing":"28pt","gap-before-crest":"25mm","gap-after-crest":"25mm","execute-dir":"file","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"pdflatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","highlight-style":"github","output-file":"Week1-Notes.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["references.bib"],"space-before-code-block":"10pt","space-after-code-block":"8pt","linespacing":"22pt plus2pt","frontmatter-linespacing":"17pt plus1pt minus1pt","title-size":"22pt","title-size-linespacing":"28pt","gap-before-crest":"25mm","gap-after-crest":"25mm","execute-dir":"file","documentclass":"scrreprt","geometry":["heightrounded"],"pandoc_args":"--listings","header-includes":["\\usepackage{fvextra} \\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\\\\{\\}}"],"colorlinks":true,"code-block-bg":"D3D3D3"},"extensions":{"book":{}}}}}